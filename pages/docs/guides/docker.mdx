# Docker

SoulFire + Docker = ❤️
Official Docker images are available on [Docker Hub](https://hub.docker.com/r/alexprogrammerde/soulfire).
Those contain the SoulFire Dedicated Server.
This guide assumes you know Docker and Docker compose well and are able to troubleshoot issues on your own.

## Pterodactyl/Pelican panel egg

You want to use Docker without the hassle of setting up the container yourself?
If you are a user of Pterodactyl/Pelican, you can use this egg:

```json
{
    "_comment": "DO NOT EDIT: FILE GENERATED AUTOMATICALLY BY PANEL",
    "meta": {
        "version": "PTDL_v2",
        "update_url": null
    },
    "exported_at": "2024-06-02T14:43:51+00:00",
    "name": "SoulFire",
    "author": "mail@pistonmaster.net",
    "uuid": "dcbaf5f6-1418-40cc-9563-8fa1c3460cb2",
    "description": "Creates a container that runs a SoulFire dedicated server.",
    "features": null,
    "docker_images": {
        "alexprogrammerde\/soulfire": "alexprogrammerde\/soulfire"
    },
    "file_denylist": [],
    "startup": "/bin/sh /soulfire/start.sh",
    "config": {
        "files": "{}",
        "startup": "{\r\n    \"done\": \"Finished loading!\"\r\n}",
        "logs": "{}",
        "stop": "^C"
    },
    "scripts": {
        "installation": {
            "script": "#!\/bin\/bash\r\n# Java Installation Script\r\n#\r\n# Server Files: \/mnt\/server\r\nPROJECT=java\r\n\r\napt update\r\napt install -y curl jq\r\n\r\ncd \/mnt\/server",
            "container": "ghcr.io\/parkervcp\/yolks:debian",
            "entrypoint": "bash"
        }
    },
    "variables": [
        {
            "name": "JVM RAM",
            "description": "How much RAM should the JVM use? (e.g. 2G)",
            "env_variable": "SF_RAM",
            "default_value": "2G",
            "user_viewable": true,
            "user_editable": true,
            "rules": "required|string|max:15",
            "sort": null,
            "field_type": "text"
        },
        {
            "name": "JVM FLAGS",
            "description": "Extra flags for the JVM (e.g. -Dsf.prometheus.enabled=true)",
            "env_variable": "SF_JVM_FLAGS",
            "default_value": "-Dterminal.jline=false -Dterminal.ansi=true",
            "user_viewable": true,
            "user_editable": true,
            "rules": "required|string|max:9999",
            "sort": null,
            "field_type": "text"
        }
    ]
}
```

## How to install Docker?

Look at this [official guide](https://docs.docker.com/engine/install).

## Basic setup

Just setup SoulFire with no extra configuration or other services.

```yaml
services:
  app:
    image: alexprogrammerde/soulfire
    restart: always
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:38765/health"]
      interval: 30s
      timeout: 10s
      retries: 5
    ports:
      - '38765:38765'
    volumes:
      - app_data:/soulfire/data

volumes:
  app_data:
    driver: local
```

## HTTPS setup

SoulFire runs on HTTP, but if you run a web endpoint you're going to need HTTPS for client-side requests from websites.
You have two options, set up a reverse proxy with automatic HTTPS or use cloudflared as a https tunnel.

### Reverse proxy

You will have to change the placeholders for the domain and email.

```yaml
services:
  app:
    image: alexprogrammerde/soulfire
    restart: always
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:38765/health"]
      interval: 30s
      timeout: 10s
      retries: 5
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.soulfire.rule=Host(`your-domain.com`)"
      - "traefik.http.services.soulfire.loadbalancer.server.port=38765"
      - "traefik.http.routers.soulfire.entrypoints=websecure"
      - "traefik.http.routers.soulfire.tls.certresolver=myresolver"
    volumes:
      - app_data:/soulfire/data

  traefik:
    image: traefik
    command:
      - "--api.insecure=true"
      - "--providers.docker=true"
      - "--providers.docker.exposedbydefault=false"
      - "--entrypoints.web.address=:80"
      - "--entrypoints.websecure.address=:443"
      - "--certificatesresolvers.myresolver.acme.tlschallenge=true"
      - "--certificatesresolvers.myresolver.acme.email=your@email.com"
      - "--certificatesresolvers.myresolver.acme.storage=/letsencrypt/acme.json"
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock:ro"
      - "letsencrypt:/letsencrypt"

volumes:
  app_data:
      driver: local
  letsencrypt:
    driver: local
```

### Cloudflared

You get the token from the [cloudflare dashboard](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/get-started/).

```yaml
services:
  app:
    image: alexprogrammerde/soulfire
    restart: always
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:38765/health"]
      interval: 30s
      timeout: 10s
      retries: 5
    volumes:
      - app_data:/soulfire/data

  cloudflared:
    image: cloudflare/cloudflared
    command: tunnel run
    environment:
      - TUNNEL_TOKEN=mytokengoeshere

volumes:
  app_data:
    driver: local
```
